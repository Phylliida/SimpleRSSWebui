<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Simple RSS Feeds</title>
  <style>
    :root {
      --bg: #0f172a;
      --fg: #e2e8f0;
      --card: #1e293b;
      --accent: #7dd3fc;
    }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Palatino", "Book Antiqua", serif;
      background: radial-gradient(circle at 20% 20%, rgba(125, 211, 252, 0.12), transparent 35%),
                  radial-gradient(circle at 80% 0%, rgba(248, 113, 113, 0.14), transparent 30%),
                  var(--bg);
      color: var(--fg);
      display: grid;
      place-items: center;
      padding: 2rem;
    }
    .card {
      width: min(720px, 100%);
      background: var(--card);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 14px;
      box-shadow: 0 16px 60px rgba(0, 0, 0, 0.35);
      padding: 24px 26px;
    }
    h1 {
      margin: 0 0 8px;
      letter-spacing: 0.02em;
      font-size: 28px;
    }
    p {
      margin: 0 0 16px;
      color: #cbd5e1;
    }
    form {
      display: flex;
      gap: 10px;
      margin: 0;
      flex-wrap: wrap;
    }
    input[type="url"],
    input[type="text"],
    select {
      flex: 1 1 260px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(15, 23, 42, 0.8);
      color: var(--fg);
      outline: none;
    }
    input[type="url"]:focus,
    input[type="text"]:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(125, 211, 252, 0.3);
    }
    button {
      padding: 10px 16px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent), #38bdf8);
      color: #0f172a;
      font-weight: 700;
      cursor: pointer;
      transition: transform 120ms ease, box-shadow 120ms ease;
    }
    button:hover { transform: translateY(-1px); }
    button:active { transform: translateY(0); }
    a {
      color: var(--accent);
      text-decoration: none;
    }
    a:hover { text-decoration: underline; }
    .hidden { display: none; }
    .list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 8px;
    }
    .collapsible {
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.55);
      padding: 0;
      overflow: hidden;
    }
    .collapsible summary {
      list-style: none;
      cursor: pointer;
      padding: 10px 12px;
      background: rgba(255, 255, 255, 0.02);
      font-weight: 700;
      letter-spacing: 0.01em;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .collapsible[open] summary {
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }
    .collapsible summary::-webkit-details-marker { display: none; }
    .collapsible .collapsible-body {
      padding: 10px 12px 12px;
      display: grid;
      gap: 12px;
    }
    .collapsible .collapsible-body > * + * {
      margin-top: 10px;
    }
    .collapsible .list {
      padding: 10px 12px 12px;
    }
    .feeds-block {
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.55);
      overflow: hidden;
      margin-top: 4px;
    }
    .feeds-panel {
      padding: 10px 12px 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      background: rgba(255, 255, 255, 0.01);
    }
    .feeds-panel .list { padding: 0; }
    .spoiler-btn {
      width: 100%;
      text-align: left;
      border: none;
      background: rgba(255, 255, 255, 0.02);
      color: var(--fg);
      padding: 10px 12px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .feeds-block.open .spoiler-btn {
      background: rgba(255, 255, 255, 0.04);
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }
    .spoiler-arrow { transition: transform 120ms ease; display: inline-block; }
    .spoiler-btn[aria-expanded="true"] .spoiler-arrow { transform: rotate(180deg); }
    .list li {
      padding: 10px 12px;
      background: rgba(15, 23, 42, 0.7);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.07);
      word-break: break-word;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .feed-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1 1 auto;
      min-width: 0;
    }
    .feed-url {
      color: #94a3b8;
      font-size: 13px;
    }
    .folder-label {
      color: #cbd5e1;
      font-size: 13px;
    }
    .list li.viewed {
      opacity: 0.75;
    }
    #items li {
      align-items: flex-start;
      flex-direction: column;
      gap: 6px;
    }
    .item-head {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      width: 100%;
    }
    .item-main {
      flex: 1 1 auto;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .item-actions {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-left: auto;
    }
    .item-title {
      font-weight: 700;
      line-height: 1.3;
    }
    .item-title.with-avatar {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .item-title .item-avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      object-fit: cover;
      flex: 0 0 auto;
    }
    .meta {
      color: #cbd5e1;
      font-size: 14px;
    }
    .summary {
      color: #e2e8f0;
      font-size: 15px;
      line-height: 1.5;
      white-space: pre-line;
    }
    .thumb-wrap {
      flex: 0 0 auto;
    }
    .thumb {
      width: 120px;
      height: auto;
      border-radius: 8px;
      object-fit: cover;
      display: block;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
    }
    .summary img {
      max-width: 100%;
      max-height: 320px;
      height: auto;
      width: auto;
      object-fit: contain;
      display: block;
      margin: 6px 0;
      border-radius: 8px;
    }
    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.78);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      z-index: 9999;
    }
    .lightbox img {
      max-width: min(1200px, 94vw);
      max-height: 94vh;
      border-radius: 12px;
      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.55);
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: #0f172a;
    }
    .lightbox.hidden {
      display: none;
    }
    .lightbox .lightbox-close {
      position: absolute;
      top: 14px;
      right: 14px;
      width: 38px;
      height: 38px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.25);
      color: #e2e8f0;
      font-size: 20px;
      font-weight: 700;
      display: grid;
      place-items: center;
      cursor: pointer;
    }
    .delete {
      border: none;
      background: transparent;
      color: #fca5a5;
      cursor: pointer;
      font-size: 20px;
      line-height: 1;
      padding: 4px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform 120ms ease, color 120ms ease;
    }
    .delete:hover { transform: translateY(-1px); color: #fecdd3; }
    .delete:active { transform: translateY(0); }
    .feed-actions {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .folder-btn {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: rgba(148, 163, 184, 0.12);
      color: #e2e8f0;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: transform 120ms ease, border-color 120ms ease;
    }
    .folder-btn:hover { transform: translateY(-1px); border-color: rgba(148, 163, 184, 0.6); }
    .folder-btn:active { transform: translateY(0); }
    .mark {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid rgba(125, 211, 252, 0.3);
      background: rgba(125, 211, 252, 0.08);
      color: #7dd3fc;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: transform 120ms ease, border-color 120ms ease;
    }
    .mark:hover { transform: translateY(-1px); border-color: rgba(125, 211, 252, 0.6); }
    .mark:disabled { opacity: 0.6; cursor: default; transform: none; }
    .mark-box {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      color: #bae6fd;
      font-size: 13px;
      user-select: none;
    }
    .mark-toggle {
      border: 1px solid rgba(125, 211, 252, 0.25);
      background: rgba(125, 211, 252, 0.08);
      border-radius: 10px;
      width: 40px;
      height: 40px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #7dd3fc;
      cursor: pointer;
      transition: transform 120ms ease, border-color 120ms ease, background 120ms ease;
      overflow: visible;
    }
    .mark-toggle:hover { transform: translateY(-1px); border-color: rgba(125, 211, 252, 0.5); }
    .mark-toggle:active { transform: translateY(0); }
    .mark-toggle.viewed { color: #cbd5e1; background: rgba(148, 163, 184, 0.08); border-color: rgba(148, 163, 184, 0.3); }
    .mark-icon {
      width: 22px;
      height: 22px;
      display: block;
      transform: scale(4);
      transform-origin: center;
    }
    .pager {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 12px;
      font-size: 14px;
      color: #cbd5e1;
    }
    .pager button {
      padding: 8px 12px;
      border-radius: 8px;
      font-weight: 700;
      background: rgba(125, 211, 252, 0.12);
      color: #e2e8f0;
      border: 1px solid rgba(125, 211, 252, 0.25);
    }
    .pager button:disabled {
      opacity: 0.5;
      cursor: default;
      transform: none;
    }
    .items-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin: 18px 0 8px;
    }
    .items-header h2 {
      margin: 0;
    }
    .status {
      min-height: 20px;
      color: #a5f3fc;
      font-size: 14px;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
    <div class="card">
      <h1>RSS Reader</h1>
      <div class="status" id="status"></div>
      <details class="collapsible">
        <summary>Manage feeds &amp; folders <span class="spoiler-arrow">▾</span></summary>
        <div class="collapsible-body">
          <form id="feed-form">
            <input id="feed-url" type="url" name="url" placeholder="https://example.com/feed.xml" required />
            <select id="feed-folder" name="folder" aria-label="Folder">
              <option value="Default">Default</option>
            </select>
            <button type="submit">Add feed</button>
          </form>
          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <input id="new-folder" type="text" name="new-folder" placeholder="New folder name" style="flex:1 1 220px;" />
            <select id="new-folder-parent" style="min-width:160px;flex:0 0 auto;">
              <option value="">Parent (root)</option>
            </select>
            <button type="button" id="create-folder">Create folder</button>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <select id="move-folder-select" style="min-width:200px;flex:1 1 200px;">
              <option value="">Select folder</option>
            </select>
            <select id="move-folder-parent" style="min-width:160px;flex:0 0 auto;">
              <option value="">New parent (root)</option>
            </select>
            <button type="button" id="move-folder">Move folder</button>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <select id="delete-folder-select" style="min-width:200px;flex:1 1 200px;">
              <option value="">Delete folder</option>
            </select>
            <button type="button" id="delete-folder">Delete folder</button>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <label style="display:flex;align-items:center;gap:8px;font-size:14px;color:#cbd5e1;">
              <input id="opml-file" type="file" accept=".opml, text/xml" style="color:#cbd5e1;" />
            </label>
            <button type="button" id="import-opml">Import OPML</button>
            <button type="button" id="export-opml">Export OPML</button>
          </div>
        </div>
      </details>
      <div id="feeds-block" class="feeds-block">
        <button id="feeds-toggle" class="spoiler-btn" aria-expanded="false">
          <span>Feed URLs <span id="feed-summary-label">(0)</span></span>
          <span class="spoiler-arrow">▾</span>
        </button>
        <div id="feeds-panel" class="feeds-panel hidden">
          <ul id="feeds" class="list"></ul>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:10px;margin:12px 0;">
        <label for="show-viewed" style="display:flex;align-items:center;gap:8px;font-size:14px;color:#cbd5e1;">
          <input id="show-viewed" type="checkbox" />
          Show viewed items
        </label>
        <label for="folder-filter" style="display:flex;align-items:center;gap:8px;font-size:14px;color:#cbd5e1;">
          Folder:
          <select id="folder-filter" style="min-width:170px;flex:0 0 auto;">
            <option value="">All folders</option>
          </select>
        </label>
      </div>
      <label for="item-limit" style="display:flex;align-items:center;gap:8px;margin-bottom:10px;font-size:14px;color:#cbd5e1;">
        Items to show (0 = all):
        <input id="item-limit" type="number" min="0" value="50" style="width:90px;padding:6px 8px;border-radius:8px;border:1px solid rgba(255,255,255,0.12);background:rgba(15,23,42,0.8);color:var(--fg);" />
      </label>
      <div style="display:flex;align-items:center;gap:10px;margin:6px 0 12px;">
        <button type="button" id="refresh-feeds">Refresh feeds</button>
        <span id="last-refreshed" style="font-size:13px;color:#cbd5e1;">Last refreshed: —</span>
      </div>
      <div class="items-header">
        <h2>Items</h2>
        <div class="pager pager-inline" style="display:none;">
          <button class="prev-page" type="button">Previous</button>
          <div class="page-info">Page 1</div>
          <button class="next-page" type="button">Next</button>
        </div>
      </div>
      <ul id="items" class="list"></ul>
      <div class="pager pager-bottom" style="display:none;">
        <button class="prev-page" type="button">Previous</button>
        <div class="page-info">Page 1</div>
        <button class="next-page" type="button">Next</button>
      </div>
    </div>
  <script>
    const feedList = document.getElementById("feeds");
    const itemsList = document.getElementById("items");
    const statusBox = document.getElementById("status");
    const feedSummaryLabel = document.getElementById("feed-summary-label");
    const feedsBlock = document.getElementById("feeds-block");
    const feedsToggle = document.getElementById("feeds-toggle");
    const feedsPanel = document.getElementById("feeds-panel");
    const lastRefreshedLabel = document.getElementById("last-refreshed");
    const urlInput = document.getElementById("feed-url");
    const feedFolderInput = document.getElementById("feed-folder");
    const opmlInput = document.getElementById("opml-file");
    const importOpmlBtn = document.getElementById("import-opml");
    const exportOpmlBtn = document.getElementById("export-opml");
    const refreshBtn = document.getElementById("refresh-feeds");
    const itemLimitInput = document.getElementById("item-limit");
    const showViewedInput = document.getElementById("show-viewed");
    const folderFilterSelect = document.getElementById("folder-filter");
    const newFolderInput = document.getElementById("new-folder");
    const newFolderParentSelect = document.getElementById("new-folder-parent");
    const createFolderBtn = document.getElementById("create-folder");
    const moveFolderSelect = document.getElementById("move-folder-select");
    const moveFolderParentSelect = document.getElementById("move-folder-parent");
    const moveFolderBtn = document.getElementById("move-folder");
    const deleteFolderSelect = document.getElementById("delete-folder-select");
    const deleteFolderBtn = document.getElementById("delete-folder");
    const pagers = Array.from(document.querySelectorAll(".pager"));
    const pageInfos = Array.from(document.querySelectorAll(".page-info"));
    const prevPageBtns = Array.from(document.querySelectorAll(".prev-page"));
    const nextPageBtns = Array.from(document.querySelectorAll(".next-page"));
    const hashParams = () => new URLSearchParams((location.hash || "").replace(/^#/, ""));
    const initialParams = hashParams();
    const parsePositiveInt = (val, fallback) => {
      const n = parseInt(val, 10);
      return Number.isFinite(n) && n > 0 ? n : fallback;
    };
    let currentPage = parsePositiveInt(initialParams.get("page"), 1);
    let totalItems = 0;
    let feedListCache = [];
    let feedFolders = {};
    let feedTitles = {};
    let lastRefreshAt = null;
    let pendingFolderFromHash = (initialParams.get("folder") || "").trim();
    let pendingAddFolderFromHash = (initialParams.get("add_folder") || "").trim();
    let appliedFolderFromHash = false;
    let appliedAddFolderFromHash = false;
    let suppressHashChange = false;
    const defaultFolder = "Default";
    let folders = new Set([defaultFolder]);
    feedFolderInput.value = defaultFolder;
    const initialLimit = parsePositiveInt(initialParams.get("limit"), null);
    if (initialLimit !== null && itemLimitInput) {
      itemLimitInput.value = initialLimit;
    }
    const initialIncludeViewed = (initialParams.get("include_viewed") || "").toLowerCase();
    if (showViewedInput) {
      showViewedInput.checked = ["1", "true", "yes", "on"].includes(initialIncludeViewed);
    }
    if (feedsToggle) {
      feedsToggle.addEventListener("click", (ev) => {
        ev.preventDefault();
        const open = feedsToggle.getAttribute("aria-expanded") === "true";
        setFeedsOpen(!open);
      });
    }
    const esc = (text = "") =>
      text.replace(/[&<>"']/g, (ch) => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;" }[ch]));
    const safeUrl = (url = "") =>
      (typeof url === "string" && (url.startsWith("http://") || url.startsWith("https://"))) ? url : "";
    const feedLabel = (url = "") => {
      const label = feedTitles[url];
      return typeof label === "string" && label.trim() ? label : url;
    };
    const formatAgo = (ms) => {
      const sec = Math.max(0, Math.floor(ms / 1000));
      if (sec < 60) return `${sec}s ago`;
      const min = Math.floor(sec / 60);
      if (min < 60) return `${min}m ago`;
      const hr = Math.floor(min / 60);
      if (hr < 24) return `${hr}h ago`;
      const day = Math.floor(hr / 24);
      return `${day}d ago`;
    };
    const renderLastRefreshed = () => {
      if (!lastRefreshedLabel) return;
      if (!lastRefreshAt) {
        lastRefreshedLabel.textContent = "Last refreshed: —";
        return;
      }
      const opts = { dateStyle: "short", timeStyle: "short" };
      const ago = formatAgo(Date.now() - lastRefreshAt.getTime());
      lastRefreshedLabel.textContent = `Last refreshed: ${lastRefreshAt.toLocaleString(undefined, opts)} (${ago})`;
    };
    const updateLastRefreshed = (value) => {
      if (!value) {
        lastRefreshAt = null;
      } else if (value instanceof Date) {
        lastRefreshAt = value;
      } else {
        const parsed = new Date(value);
        lastRefreshAt = Number.isNaN(parsed.getTime()) ? null : parsed;
      }
      renderLastRefreshed();
    };
    renderLastRefreshed();
    setInterval(renderLastRefreshed, 30000);
    const setFeedsOpen = (isOpen) => {
      if (!feedsToggle || !feedsPanel) return;
      feedsToggle.setAttribute("aria-expanded", isOpen ? "true" : "false");
      feedsPanel.classList.toggle("hidden", !isOpen);
      if (feedsBlock) {
        feedsBlock.classList.toggle("open", isOpen);
      }
    };
    const lightbox = document.createElement("div");
    lightbox.className = "lightbox hidden";
    lightbox.innerHTML = `<button class="lightbox-close" type="button" aria-label="Close image">&times;</button><img src="" alt="" />`;
    document.body.appendChild(lightbox);
    const lightboxImg = lightbox.querySelector("img");
    const closeLightbox = () => {
      lightbox.classList.add("hidden");
      lightboxImg.removeAttribute("src");
      lightboxImg.alt = "";
      document.body.style.overflow = "";
    };
    const openLightbox = (src, alt = "") => {
      if (!src) return;
      lightboxImg.src = src;
      lightboxImg.alt = alt;
      lightbox.classList.remove("hidden");
      document.body.style.overflow = "hidden";
    };
    lightbox.addEventListener("click", (ev) => {
      if (ev.target === lightbox || ev.target.classList.contains("lightbox-close")) {
        closeLightbox();
      }
    });
    window.addEventListener("keydown", (ev) => {
      if (ev.key === "Escape" && !lightbox.classList.contains("hidden")) {
        closeLightbox();
      }
    });
    const updateHash = () => {
      const params = new URLSearchParams();
      const folder = folderFilterSelect.value || "";
      const limit = parseInt(itemLimitInput.value, 10);
      const addFolder = (feedFolderInput.value || "").trim();
      const showViewed = showViewedInput && showViewedInput.checked;
      if (folder) params.set("folder", folder);
      if (addFolder) params.set("add_folder", addFolder);
      if (showViewed) params.set("include_viewed", "1");
      if (Number.isFinite(limit) && limit > 0) params.set("limit", limit);
      if (currentPage > 1) params.set("page", currentPage);
      const nextHash = params.toString();
      const target = nextHash ? `#${nextHash}` : "";
      if (location.hash === target) return;
      suppressHashChange = true;
      location.hash = target;
      setTimeout(() => { suppressHashChange = false; }, 0);
    };
    const viewedIcon = `<svg class="mark-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M1.606 6.08a1 1 0 0 1 1.313.526L2 7l.92-.394v-.001l.003.009l.021.045l.094.194c.086.172.219.424.4.729a13.4 13.4 0 0 0 1.67 2.237a12 12 0 0 0 .59.592C7.18 11.8 9.251 13 12 13a8.7 8.7 0 0 0 3.22-.602c1.227-.483 2.254-1.21 3.096-1.998a13 13 0 0 0 2.733-3.725l.027-.058l.005-.011a1 1 0 0 1 1.838.788L22 7l.92.394l-.003.005l-.004.008l-.011.026l-.04.087a14 14 0 0 1-.741 1.348a15.4 15.4 0 0 1-1.711 2.256l.797.797a1 1 0 0 1-1.414 1.415l-.84-.84a12 12 0 0 1-1.897 1.256l.782 1.202a1 1 0 1 1-1.676 1.091l-.986-1.514c-.679.208-1.404.355-2.176.424V16.5a1 1 0 0 1-2 0v-1.544c-.775-.07-1.5-.217-2.177-.425l-.985 1.514a1 1 0 0 1-1.676-1.09l.782-1.203c-.7-.37-1.332-.8-1.897-1.257l-.84.84a1 1 0 0 1-1.414-1.414l.797-.797a15.4 15.4 0 0 1-1.87-2.519a14 14 0 0 1-.591-1.107l-.033-.072l-.01-.021l-.002-.007l-.001-.002v-.001C1.08 7.395 1.08 7.394 2 7l-.919.395a1 1 0 0 1 .525-1.314" clip-rule="evenodd"/></svg>`;
    const unviewedIcon = `<svg class="mark-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3.275 15.296C2.425 14.192 2 13.639 2 12c0-1.64.425-2.191 1.275-3.296C4.972 6.5 7.818 4 12 4s7.028 2.5 8.725 4.704C21.575 9.81 22 10.361 22 12c0 1.64-.425 2.191-1.275 3.296C19.028 17.5 16.182 20 12 20s-7.028-2.5-8.725-4.704Z"/><path d="M15 12a3 3 0 1 1-6 0a3 3 0 0 1 6 0Z"/></g></svg>`;
    const syncFolderSelects = () => {
      const filterCurrent = folderFilterSelect.value;
      const parentCurrent = newFolderParentSelect.value;
      const moveCurrent = moveFolderSelect.value;
      const moveParentCurrent = moveFolderParentSelect.value;
      const deleteCurrent = deleteFolderSelect.value;
      const addCurrent = feedFolderInput.value;
      const values = Array.from(new Set([defaultFolder, ...folders]));
      values.sort((a, b) => a.localeCompare(b));
      const optionList = values.map((f) => `<option value="${esc(f)}">${esc(f)}</option>`).join("");
      folderFilterSelect.innerHTML = `<option value="">All folders</option>${optionList}`;
      folderFilterSelect.value = values.includes(filterCurrent) ? filterCurrent : "";
      const parentOptions = `<option value="">Parent (root)</option>${optionList}`;
      newFolderParentSelect.innerHTML = parentOptions;
      moveFolderParentSelect.innerHTML = parentOptions.replace("Parent (root)", "New parent (root)");
      feedFolderInput.innerHTML = optionList;
      const preferredAdd = (!appliedAddFolderFromHash && pendingAddFolderFromHash) ? pendingAddFolderFromHash : addCurrent;
      feedFolderInput.value = values.includes(preferredAdd) ? preferredAdd : defaultFolder;
      if (!appliedAddFolderFromHash && pendingAddFolderFromHash && values.includes(pendingAddFolderFromHash)) {
        appliedAddFolderFromHash = true;
      }
      if (!values.includes(parentCurrent)) {
        newFolderParentSelect.value = "";
      } else {
        newFolderParentSelect.value = parentCurrent;
      }
      moveFolderSelect.innerHTML = `<option value="">Select folder</option>${optionList}`;
      moveFolderSelect.value = values.includes(moveCurrent) ? moveCurrent : "";
      if (!values.includes(moveParentCurrent)) {
        moveFolderParentSelect.value = "";
      } else {
        moveFolderParentSelect.value = moveParentCurrent;
      }
      const deletable = values.filter((f) => f !== defaultFolder);
      const deleteOptions = deletable.map((f) => `<option value="${esc(f)}">${esc(f)}</option>`).join("");
      deleteFolderSelect.innerHTML = `<option value="">Delete folder</option>${deleteOptions}`;
      deleteFolderSelect.value = deletable.includes(deleteCurrent) ? deleteCurrent : "";
    };

    const renderFeeds = (feeds) => {
      const filter = folderFilterSelect.value || "";
      const filtered = filter
        ? feeds.filter((url) => {
            const folders = Array.isArray(feedFolders[url]) && feedFolders[url].length
              ? feedFolders[url]
              : [defaultFolder];
            return folders.some((folder) => folder === filter || folder.startsWith(`${filter}/`));
          })
        : feeds;
      if (feedSummaryLabel) {
        feedSummaryLabel.textContent = `(${filtered.length})`;
      }
      const folderOptions = (current) => {
        const opts = Array.from(new Set([defaultFolder, ...folders, current || defaultFolder]));
        opts.sort((a, b) => a.localeCompare(b));
        return opts.map((f) => `<option value="${esc(f)}"${f === current ? " selected" : ""}>${esc(f)}</option>`).join("");
      };
      feedList.innerHTML = filtered.map((url) => {
        const foldersForFeed = Array.isArray(feedFolders[url]) && feedFolders[url].length
          ? feedFolders[url]
          : [defaultFolder];
        const primaryFolder = foldersForFeed[0];
        const folderLabel = foldersForFeed.map(esc).join(", ");
        const safe = esc(url);
        const label = esc(feedLabel(url));
        return `<li>
          <div class="feed-info">
            <span>${label}</span>
            <div class="feed-url">${safe}</div>
            <div class="folder-label">Folders: ${folderLabel}</div>
          </div>
          <div class="feed-actions">
            <select class="folder-select" data-url="${safe}" data-current="${esc(primaryFolder)}" aria-label="Move ${safe}">
              ${folderOptions(primaryFolder)}
            </select>
            <button class="delete" data-url="${safe}" aria-label="Remove ${safe}">&minus;</button>
          </div>
        </li>`;
      }).join("");
    };

    const applyFeeds = (data = {}) => {
      const feeds = Array.isArray(data.feeds) ? data.feeds : [];
      const incomingFolders = data.feed_folders && typeof data.feed_folders === "object" ? data.feed_folders : {};
      const incomingTitles = data.feed_titles && typeof data.feed_titles === "object" ? data.feed_titles : {};
      const mergedTitles = { ...feedTitles, ...incomingTitles };
      feedTitles = feeds.reduce((acc, url) => {
        const title = mergedTitles[url];
        if (typeof title === "string" && title.trim()) acc[url] = title;
        return acc;
      }, {});
      if (feedSummaryLabel) {
        feedSummaryLabel.textContent = `(${feeds.length})`;
      }
      feedListCache = feeds;
      feedFolders = {};
      feeds.forEach((url) => {
        const raw = incomingFolders[url];
        const list = Array.isArray(raw)
          ? raw.map((v) => (typeof v === "string" ? v.trim() : "")).filter(Boolean)
          : typeof raw === "string" && raw.trim() ? [raw.trim()] : [];
        const unique = Array.from(new Set(list));
        unique.sort((a, b) => a.localeCompare(b));
        feedFolders[url] = unique.length ? unique : [defaultFolder];
      });
      const allFolders = new Set([defaultFolder, ...(Array.isArray(data.folders) ? data.folders : [])]);
      Object.values(feedFolders).forEach((arr) => {
        (Array.isArray(arr) ? arr : []).forEach((name) => {
          if (typeof name === "string" && name.trim()) allFolders.add(name);
        });
      });
      folders = allFolders;
      syncFolderSelects();
      if (!appliedFolderFromHash && pendingFolderFromHash) {
        const hasFolder = Array.from(folderFilterSelect.options).some((opt) => opt.value === pendingFolderFromHash);
        folderFilterSelect.value = hasFolder ? pendingFolderFromHash : "";
        appliedFolderFromHash = true;
      }
      if (!appliedAddFolderFromHash && pendingAddFolderFromHash) {
        const hasAddFolder = Array.from(feedFolderInput.options || []).some((opt) => opt.value === pendingAddFolderFromHash);
        feedFolderInput.value = hasAddFolder ? pendingAddFolderFromHash : feedFolderInput.value;
        appliedAddFolderFromHash = true;
      }
      renderFeeds(feeds);
    };

    const formatTime = (value) => {
      if (!value) return "";
      const parsed = new Date(value);
      return Number.isNaN(parsed.getTime())
        ? value
        : parsed.toLocaleString(undefined, { dateStyle: "medium", timeStyle: "short" });
    };

    const sanitizeSummary = (html = "") => {
      const allowed = new Set(["a", "p", "br", "strong", "em", "b", "i", "u", "ul", "ol", "li", "pre", "code", "span", "div", "img"]);
      const attrAllow = { a: ["href", "title"], img: ["src", "alt", "title"] };
      const safeUrl = (url = "") => (url.startsWith("http://") || url.startsWith("https://")) ? url : "";
      const doc = new DOMParser().parseFromString(html, "text/html");
      const clean = (node) => {
        if (node.nodeType === Node.TEXT_NODE) return document.createTextNode(node.textContent || "");
        if (node.nodeType !== Node.ELEMENT_NODE) return null;
        const tag = node.tagName.toLowerCase();
        if (!allowed.has(tag)) return document.createTextNode(node.textContent || "");
        const el = document.createElement(tag);
        (attrAllow[tag] || []).forEach((attr) => {
          const val = node.getAttribute(attr);
          if (!val) return;
          if (attr === "href" || attr === "src") {
            const safe = safeUrl(val);
            if (!safe) return;
            el.setAttribute(attr, safe);
          } else {
            el.setAttribute(attr, val);
          }
        });
        if (tag === "a" && el.getAttribute("href")) {
          el.setAttribute("rel", "noopener noreferrer");
          el.setAttribute("target", "_blank");
        }
        node.childNodes.forEach((child) => {
          const cleaned = clean(child);
          if (cleaned) el.appendChild(cleaned);
        });
        return el;
      };
      const container = document.createElement("div");
      doc.body.childNodes.forEach((child) => {
        const cleaned = clean(child);
        if (cleaned) container.appendChild(cleaned);
      });
      return container.innerHTML;
    };

    const renderItems = (items) => {
      itemsList.innerHTML = (items || []).map((item) => {
        const titleText = String(item.title || "(untitled)");
        const title = esc(titleText);
        const safeLink = esc(item.link || "");
        const link = item.link ? `<a href="${safeLink}" target="_blank" rel="noopener noreferrer">${title}</a>` : title;
        const blueskyAvatarUrl = safeUrl(item.bluesky_author_avatar || "");
        const blueskyAvatarAlt = esc(item.bluesky_author_display || item.bluesky_author_handle || titleText || "Author");
        const avatar = blueskyAvatarUrl
          ? `<img class="item-avatar" src="${esc(blueskyAvatarUrl)}" alt="${blueskyAvatarAlt}" loading="lazy" />`
          : "";
        const titleBlock = blueskyAvatarUrl
          ? `<div class="item-title with-avatar">${avatar}${link}</div>`
          : `<div class="item-title">${link}</div>`;
        const thumbUrl = safeUrl(item.thumbnail || "");
        const thumbLinkOpen = item.link ? ` href="${safeLink}" target="_blank" rel="noopener noreferrer"` : "";
        const thumb = thumbUrl ? `<div class="thumb-wrap"><a${thumbLinkOpen}><img class="thumb" src="${esc(thumbUrl)}" alt="" loading="lazy" /></a></div>` : "";
        const feedNameRaw = feedTitles[item.feed] || item.feed_title || item.feed;
        const feedName = typeof feedNameRaw === "string" ? feedNameRaw : "";
        const showFeedName = feedName && feedName.trim().toLowerCase() !== titleText.trim().toLowerCase();
        const blueskyHandleRaw = typeof item.bluesky_author_handle === "string" ? item.bluesky_author_handle.trim() : "";
        const blueskyHandle = blueskyHandleRaw ? (blueskyHandleRaw.startsWith("@") ? blueskyHandleRaw : `@${blueskyHandleRaw}`) : "";
        const metaBits = [];
        if (blueskyHandle) metaBits.push(esc(blueskyHandle));
        else if (showFeedName) metaBits.push(esc(feedName));
        const published = formatTime(item.published);
        if (published) metaBits.push(esc(published));
        const meta = metaBits.length ? `<div class="meta">${metaBits.join(" · ")}</div>` : "";
        const summary = item.summary ? `<div class="summary">${sanitizeSummary(item.summary)}</div>` : "";
        const viewed = Boolean(item.viewed);
        const mark = item.id
          ? `<div class="item-actions">
              <button class="mark-toggle ${viewed ? "viewed" : ""}" data-id="${esc(item.id)}" data-viewed="${viewed ? "true" : "false"}" title="Toggle viewed">
                ${viewed ? viewedIcon : unviewedIcon}
              </button>
             </div>`
          : "";
        const liClass = viewed ? "viewed" : "";
        return `<li class="${liClass}">
          <div class="item-head">
            ${thumb}
            <div class="item-main">
              ${titleBlock}
              ${meta}
            </div>
            ${mark}
          </div>
          ${summary}
        </li>`;
      }).join("");
    };

    const setStatus = (text, isError = false) => {
      statusBox.textContent = text || "";
      statusBox.style.color = isError ? "#fca5a5" : "#a5f3fc";
    };

    const fetchFeeds = () =>
      fetch("/api/feeds")
        .then((r) => r.json())
        .then((data) => {
          applyFeeds(data);
          updateLastRefreshed(data.last_refreshed);
        })
        .catch(() => setStatus("Failed to load feeds", true));

    const fetchItems = () => {
      const n = parseInt(itemLimitInput.value, 10);
      const limit = Number.isFinite(n) ? n : 30;
      const params = [];
      params.push(limit > 0 ? `limit=${limit}` : "limit=0");
      if (limit > 0) params.push(`page=${currentPage}`);
      if (showViewedInput.checked) params.push("include_viewed=1");
      if (folderFilterSelect.value) params.push(`folder=${encodeURIComponent(folderFilterSelect.value)}`);
      const qs = params.length ? `?${params.join("&")}` : "";
      return fetch(`/api/items${qs}`)
        .then((r) => r.json())
        .then((data) => {
          const items = Array.isArray(data.items) ? data.items : [];
          const incomingTitles = data.feed_titles && typeof data.feed_titles === "object" ? data.feed_titles : {};
          let titlesChanged = false;
          const nextTitles = { ...feedTitles };
          Object.entries(incomingTitles).forEach(([url, title]) => {
            if (typeof url !== "string" || typeof title !== "string") return;
            const clean = title.trim();
            if (!clean) return;
            if (nextTitles[url] !== clean) titlesChanged = true;
            nextTitles[url] = clean;
          });
          items.forEach((item) => {
            const url = typeof item.feed === "string" ? item.feed : "";
            const title = typeof item.feed_title === "string" ? item.feed_title : "";
            const clean = title.trim();
            if (!url || !clean) return;
            if (nextTitles[url] !== clean) titlesChanged = true;
            nextTitles[url] = clean;
          });
          feedTitles = nextTitles;
          if (titlesChanged && feedListCache.length) {
            renderFeeds(feedListCache);
          }
          totalItems = data.total || items.length;
          const pageFromServer = data.page || 1;
          const maxPage = limit > 0 ? Math.max(1, Math.ceil((totalItems || 0) / limit)) : 1;
          if (pageFromServer > maxPage) {
            currentPage = maxPage;
            return fetchItems();
          }
          currentPage = pageFromServer;
          updateHash();
          renderItems(items);
          updatePager(maxPage);
          updateLastRefreshed(data.last_refreshed);
        })
        .catch(() => setStatus("Failed to load items", true));
    };

    document.getElementById("feed-form").addEventListener("submit", (ev) => {
      ev.preventDefault();
      const url = urlInput.value.trim();
      const folder = (feedFolderInput.value || "").trim() || defaultFolder;
      if (!url) return;
      setStatus("Adding feed...");
      fetch("/api/feeds", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url, folder }),
      })
        .then((r) => r.json().then((data) => ({ status: r.status, data })))
        .then(({ status, data }) => {
          if (status >= 400) throw new Error(data.error || "Failed");
          applyFeeds(data);
          setStatus(data.message || "Added");
          urlInput.value = "";
        })
        .catch((err) => setStatus(err.message || "Failed to add feed", true));
    });

    importOpmlBtn.addEventListener("click", () => {
      const file = (opmlInput.files || [])[0];
      if (!file) {
        setStatus("Choose an OPML file first", true);
        return;
      }
      const form = new FormData();
      form.append("file", file);
      setStatus("Importing OPML...");
      fetch("/api/feeds/import", { method: "POST", body: form })
        .then((r) => r.json().then((data) => ({ status: r.status, data })))
        .then(({ status, data }) => {
          if (status >= 400) throw new Error(data.error || "Failed");
          applyFeeds(data);
          setStatus(data.message || "Imported");
          fetchItems();
        })
        .catch((err) => setStatus(err.message || "Failed to import", true));
    });

    exportOpmlBtn.addEventListener("click", () => {
      setStatus("Exporting OPML...");
      fetch("/api/feeds/export")
        .then((r) => {
          if (!r.ok) throw new Error("Failed");
          return r.blob();
        })
        .then((blob) => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "feeds.opml";
          a.click();
          URL.revokeObjectURL(url);
          setStatus("Exported");
        })
        .catch((err) => setStatus(err.message || "Failed to export", true));
    });

    refreshBtn.addEventListener("click", () => {
      setStatus("Refreshing feeds...");
      refreshBtn.disabled = true;
      fetch("/api/feeds/refresh", { method: "POST" })
        .then((r) => r.json().then((data) => ({ status: r.status, data })))
        .then(({ status, data }) => {
          if (status >= 400) throw new Error(data.error || "Failed");
          applyFeeds(data);
          setStatus(data.message || "Refreshed");
          currentPage = 1;
          return fetchItems();
        })
        .catch((err) => setStatus(err.message || "Failed to refresh", true))
        .finally(() => {
          refreshBtn.disabled = false;
        });
    });

    createFolderBtn.addEventListener("click", () => {
      const name = (newFolderInput.value || "").trim();
      const parent = (newFolderParentSelect.value || "").trim();
      if (!name) {
        setStatus("Folder name required", true);
        return;
      }
      createFolderBtn.disabled = true;
      setStatus("Creating folder...");
      fetch("/api/folders", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, parent }),
      })
        .then((r) => r.json().then((data) => ({ status: r.status, data })))
        .then(({ status, data }) => {
          if (status >= 400) throw new Error(data.error || "Failed");
          applyFeeds(data);
          newFolderInput.value = "";
          newFolderParentSelect.value = parent || "";
          setStatus(data.message || "Folder created");
        })
        .catch((err) => setStatus(err.message || "Failed to create folder", true))
        .finally(() => {
          createFolderBtn.disabled = false;
        });
    });

    moveFolderBtn.addEventListener("click", () => {
      const folder = (moveFolderSelect.value || "").trim();
      const parent = (moveFolderParentSelect.value || "").trim();
      if (!folder) {
        setStatus("Choose a folder to move", true);
        return;
      }
      moveFolderBtn.disabled = true;
      setStatus("Moving folder...");
      fetch("/api/folders/move", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ folder, parent }),
      })
        .then((r) => r.json().then((data) => ({ status: r.status, data })))
        .then(({ status, data }) => {
          if (status >= 400) throw new Error(data.error || "Failed");
          applyFeeds(data);
          moveFolderParentSelect.value = parent || "";
          setStatus(data.message || "Folder moved");
        })
        .catch((err) => setStatus(err.message || "Failed to move folder", true))
        .finally(() => {
          moveFolderBtn.disabled = false;
        });
    });

    deleteFolderBtn.addEventListener("click", () => {
      const folder = (deleteFolderSelect.value || "").trim();
      if (!folder || folder === defaultFolder) {
        setStatus("Choose a folder to delete", true);
        return;
      }
      deleteFolderBtn.disabled = true;
      setStatus("Deleting folder...");
      fetch("/api/folders", {
        method: "DELETE",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ folder }),
      })
        .then((r) => r.json().then((data) => ({ status: r.status, data })))
        .then(({ status, data }) => {
          if (status >= 400) throw new Error(data.error || "Failed");
          applyFeeds(data);
          deleteFolderSelect.value = "";
          currentPage = 1;
          setStatus(data.message || "Folder deleted");
          return fetchItems();
        })
        .catch((err) => setStatus(err.message || "Failed to delete folder", true))
        .finally(() => {
          deleteFolderBtn.disabled = false;
        });
    });

    moveFolderSelect.addEventListener("change", () => {
      moveFolderParentSelect.value = "";
    });

    feedList.addEventListener("change", (ev) => {
      const select = ev.target.closest("select.folder-select");
      if (!select) return;
      const url = select.dataset.url;
      if (!url) return;
      const previous = select.dataset.current || defaultFolder;
      const folder = (select.value || "").trim() || defaultFolder;
      select.disabled = true;
      setStatus("Moving feed...");
      fetch("/api/feeds/folder", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url, folder }),
      })
        .then((r) => r.json().then((data) => ({ status: r.status, data })))
        .then(({ status, data }) => {
          if (status >= 400) throw new Error(data.error || "Failed");
          applyFeeds(data);
          setStatus(data.message || "Moved");
          currentPage = 1;
          return fetchItems();
        })
        .catch((err) => {
          select.disabled = false;
          select.value = previous;
          setStatus(err.message || "Failed to move feed", true);
        });
    });

    feedList.addEventListener("click", (ev) => {
      const btn = ev.target.closest("button.delete");
      if (!btn) return;
      const url = btn.dataset.url;
      setStatus("Removing feed...");
      fetch("/api/feeds", {
        method: "DELETE",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url }),
      })
        .then((r) => r.json().then((data) => ({ status: r.status, data })))
        .then(({ status, data }) => {
          if (status >= 400) throw new Error(data.error || "Failed");
          applyFeeds(data);
          setStatus(data.message || "Removed");
          fetchItems();
        })
        .catch((err) => setStatus(err.message || "Failed to remove feed", true));
    });

    itemLimitInput.addEventListener("change", () => {
      currentPage = 1;
      updateHash();
      fetchItems();
    });
    showViewedInput.addEventListener("change", () => {
      fetchItems();
    });
    folderFilterSelect.addEventListener("change", () => {
      currentPage = 1;
      renderFeeds(feedListCache);
      updateHash();
      fetchItems();
    });
    prevPageBtns.forEach((btn) =>
      btn.addEventListener("click", () => {
        if (currentPage <= 1) return;
        currentPage -= 1;
        fetchItems();
      })
    );
    nextPageBtns.forEach((btn) =>
      btn.addEventListener("click", () => {
        const n = parseInt(itemLimitInput.value, 10);
        if (!(Number.isFinite(n) && n > 0)) return;
        const maxPage = Math.max(1, Math.ceil((totalItems || 0) / n));
        if (currentPage >= maxPage) return;
        currentPage += 1;
        fetchItems();
      })
    );

    const applyHashState = () => {
      if (suppressHashChange) return;
      const params = hashParams();
      const folder = (params.get("folder") || "").trim();
      const page = parsePositiveInt(params.get("page"), 1);
      const limit = parsePositiveInt(params.get("limit"), null);
      const addFolder = (params.get("add_folder") || "").trim();
      const includeViewed = (params.get("include_viewed") || "").toLowerCase();
      if (showViewedInput) {
        showViewedInput.checked = ["1", "true", "yes", "on"].includes(includeViewed);
      }
      if (limit !== null) {
        itemLimitInput.value = limit;
      }
      pendingFolderFromHash = folder;
      pendingAddFolderFromHash = addFolder;
      appliedFolderFromHash = false;
      appliedAddFolderFromHash = false;
      currentPage = page;
      renderFeeds(feedListCache);
      fetchItems();
    };

    window.addEventListener("hashchange", applyHashState);
    feedFolderInput.addEventListener("change", () => {
      updateHash();
    });

    itemsList.addEventListener("click", (ev) => {
      const img = ev.target.closest(".summary img");
      if (img) {
        const src = img.getAttribute("src") || "";
        if (src.startsWith("http://") || src.startsWith("https://")) {
          ev.preventDefault();
          openLightbox(src, img.getAttribute("alt") || "");
        }
        return;
      }
      const btn = ev.target.closest("button.mark-toggle");
      if (!btn) return;
      const id = btn.dataset.id;
      if (!id) return;
      const nextViewed = btn.dataset.viewed === "true" ? false : true;
      btn.disabled = true;
      setStatus(nextViewed ? "Marking viewed..." : "Unmarking...");
      fetch("/api/items/viewed", {
        method: nextViewed ? "POST" : "DELETE",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id }),
      })
        .then((r) => r.json().then((data) => ({ status: r.status, data })))
        .then(({ status, data }) => {
          if (status >= 400) throw new Error(data.error || "Failed");
          setStatus(data.message || (nextViewed ? "Marked" : "Unmarked"));
          fetchItems();
        })
        .catch((err) => {
          btn.disabled = false;
          setStatus(err.message || "Failed to update", true);
        });
    });

    const updatePager = (maxPage) => {
      const n = parseInt(itemLimitInput.value, 10);
      const limit = Number.isFinite(n) ? n : 30;
      const disablePaging = !Number.isFinite(limit) || limit <= 0 || totalItems <= limit;
      pagers.forEach((p) => {
        p.style.display = disablePaging ? "none" : "flex";
      });
      if (disablePaging) return;
      pageInfos.forEach((info) => {
        info.textContent = `Page ${currentPage} of ${maxPage}`;
      });
      prevPageBtns.forEach((btn) => {
        btn.disabled = currentPage <= 1;
      });
      nextPageBtns.forEach((btn) => {
        btn.disabled = currentPage >= maxPage;
      });
    };

    fetchFeeds().then(fetchItems).catch(fetchItems);
  </script>
</body>
</html>
